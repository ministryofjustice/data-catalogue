source:
  type: dbt
  config:
    aws_connection:
      aws_region: eu-west-1
    manifest_path: "s3://mojap-derived-tables/prod/run_artefacts/latest/target/manifest.json"
    catalog_path: "s3://mojap-derived-tables/prod/run_artefacts/latest/target/catalog.json"
    test_results_path: "s3://mojap-derived-tables/prod/run_artefacts/latest/target/run_results.json"
    target_platform: athena
    infer_dbt_schemas: true
    node_name_pattern:
      allow:
        - ".*bold_sm_spells.*"
        - ".*common_platform.*"
        - ".*sirius.*"
    entities_enabled:
      test_results: "YES"
      seeds: "NO"
      snapshots: "YES"
      models: "YES"
      sources: "YES"
      test_definitions: "YES"
    stateful_ingestion:
      remove_stale_metadata: true

transformers:
  - type: "ingestion.transformers.assign_cadet_domains.AssignDerivedTableDomains"
    config:
      manifest_s3_uri: "s3://mojap-derived-tables/prod/run_artefacts/latest/target/manifest.json"
      replace_existing: true
  - type: "add_dataset_tags"

    config:
      get_tags_to_add: "ingestion.cadet_display_in_catalogue_tagger.add_display_in_catalogue_tag"
